(async()=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function ve(...e){let t=document.createElement("div");return t.classList.add(...e),t}Node.prototype.div=function(...e){let t=ve(...e);return this.append(t),t};async function Q(e){let t=await fetch(e).then(n=>n.text());return new DOMParser().parseFromString(t,"text/html")}async function ke(e){return fetch(e).then(t=>t.json())}function Se(e,t,n){return Math.max(t,Math.min(n,e))}function O(e,t){return Se(e,0,t-1)}function Y(e,t){return e>=0&&e<t}const Ae="/PsiEdit/assets/controls-e7d3d7cb.html",z=["target","number","number1","number2","number3","number4","vector1","vector2","vector3","vector4","position","min","max","power","x","y","z","radius","distance","time","base","ray","vector","axis","angle","pitch","instrument","volume","list1","list2","list","direction","from1","from2","to1","to2","root","toggle","mask","channel","slot","ray_end","ray_start"];function E(e,t){j(e),e.element.append(t),e.piece=t}function j(e){e.piece&&(e.piece.remove(),e.piece=null)}function q(e){return e.cloneNode(!0)}function k(e,t,n=null,r=null){e.dataset.side=t,r&&w(r,n);let a=e.parentNode.querySelector(`.line[data-trigger='${e.dataset.key}']`);a&&(a.dataset.side=t)}function R(e){return e.dataset.side}function W(e){return e.dataset.optional!=null}function Z(e){return e.dataset.sortingName.toLowerCase()}let ee,te,ne,re;Q(Ae).then(e=>{ee=e.querySelector(".param-control"),re=e.querySelector(".related-control"),te=e.querySelector(".value-control"),ne=e.querySelector(".text-control")});function w(e,t){if(xe(e),!t.cell||!t.cell.piece)return;let n=t.cell.piece;if(e.element.style.setProperty("--piece-name",'"'+n.dataset.name+'"'),e.element.style.setProperty("--piece-desc",'"'+n.dataset.desc+'"'),n.querySelectorAll(".param").forEach(r=>{let a=ee.cloneNode(!0);a.style.setProperty("--param-name",'"'+r.dataset.name+'"'),r.dataset.color!=null&&(a.dataset.color=r.dataset.color),r.dataset.side!=null&&(a.dataset.side=r.dataset.side),r.dataset.optional!=null&&(a.dataset.optional=r.dataset.optional),a.querySelectorAll("[data-side]").forEach(o=>o.addEventListener("click",()=>{k(r,o.dataset.side,t,e)})),e.element.append(a),e.controls.push(a),e.params.push(r)}),n.dataset.key=="psi:constant_number"){let r=te.cloneNode(!0);r.style.setProperty("--param-name",'"Value"'),r.dataset.color="gray";let a=r.querySelector("[data-value]");a.value=n.querySelector("[data-value]").textContent,a.addEventListener("input",()=>{let o=n.querySelector("[data-value]");o.textContent=a.value=a.value.substring(0,5),o.style.setProperty("--scale-value",[1,1,.8,.7,.6,.5][a.value.length-1])}),e.element.append(r),e.controls.push(r)}{let r=ne.cloneNode(!0);r.style.setProperty("--param-name",'"Comment"'),r.dataset.color="gray";let a=r.querySelector("[data-value]");a.value=(n.dataset.comment||"").replaceAll(";",`
`),a.addEventListener("input",()=>n.dataset.comment=a.value.replaceAll(`
`,";")),e.element.append(r),e.controls.push(r),e.comment=a}if(n.dataset.related)for(let r of n.dataset.related.split(" ")){let a=re.cloneNode(!0);a.style.setProperty("--param-name",'"'+r.substring(0,r.indexOf("="))+'"'),a.dataset.color="gray";let o=a.querySelector("[data-pieces]");for(let s of r.substring(r.indexOf("=")+1).split(",")){let i=o.div("catalog-item"),l=s.includes(":")?s:n.dataset.key.substring(0,n.dataset.key.indexOf(":"))+":"+s;i.append(A[l].cloneNode(!0)),i.addEventListener("click",()=>{E(t.cell,q(A[l])),w(e,t)})}e.element.append(a),e.controls.push(a)}}function xe(e){e.element.style.removeProperty("--piece-name"),e.element.style.removeProperty("--piece-desc"),e.controls.forEach(t=>t.remove()),e.controls=[],e.params=[],e.values=[],e.comment=null}async function Ee(e){let t={},n,r,a;if(e.querySelectorAll("meta").forEach(o=>{n=n||o.dataset.repo,r=r||o.dataset.namespace}),!n||!r)return console.error("Missing metadata in piece list"),t;e.querySelectorAll("[data-icon]").forEach(o=>{o.style.setProperty("--icon",`url('https://raw.githubusercontent.com/${n}/master/src/main/resources/assets/${r}/textures/spell/${o.dataset.icon}.png')`)});try{a=await ke(`https://raw.githubusercontent.com/${n}/master/src/main/resources/assets/${r}/lang/en_us.json`)}catch{}return a=a||{},e.querySelectorAll(".piece").forEach(o=>{n&&r&&o.style.setProperty("--piece-icon",`url('https://raw.githubusercontent.com/${n}/master/src/main/resources/assets/${r}/textures/spell/${o.dataset.icon||o.dataset.type}.png')`),o.dataset.name=o.dataset.name||a[`${r}.spellpiece.${o.dataset.type}`]||`${r}.spellpiece.${o.dataset.type}`,o.dataset.desc=o.dataset.desc||a[`${r}.spellpiece.${o.dataset.type}.desc`]||`${r}.spellpiece.${o.dataset.type}.desc`,o.dataset.key=o.dataset.key||`${r}:${o.dataset.type}`,o.dataset.sortingName=o.dataset.sortingName||o.dataset.name,o.dataset.tooltip=o.dataset.name+`
`+o.dataset.desc,t[o.dataset.key]=o}),t}function qe(e,t=!1){if(t){let o=[],s=new TextEncoder().encode(e.dataset.key);if(s.length>255)throw new Error("Key too long");o.push(new Uint8Array([s.length&255])),o.push(s);let i=new TextEncoder().encode(e.dataset.comment||"");if(i.length>65535)throw new Error("Comment too long");o.push(new Uint8Array([i.length&255,i.length>>8&255])),o.push(i);let l={};if(e.querySelectorAll(".param").forEach(_=>{_.dataset.side!="off"&&(l[_.dataset.key]=ae(_.dataset.side))}),Object.keys(l).length>255)throw new Error("Too many params");o.push(new Uint8Array([Object.keys(l).length&255]));for(let _ in l){if(_.startsWith("_")&&z.includes(_.substring(1)))o.push(new Uint8Array([255,z.indexOf(_.substring(1))]));else{let x=new TextEncoder().encode(_);if(_.length>254)throw new Error("Param key too long");o.push(new Uint8Array([x.length&255])),o.push(x)}o.push(new Uint8Array([l[_]&255]))}if(e.dataset.key=="psi:constant_number"){let _=e.querySelector("[data-value]").textContent,x=new TextEncoder().encode(_);o.push(new Uint8Array([x.length&255])),o.push(x)}let p=new Uint8Array(o.map(_=>_.length).reduce((_,x)=>_+x)),v=0;for(let _ of o)p.set(_,v),v+=_.length;return p}let n={},r=!1;e.querySelectorAll(".param").forEach(o=>{n[o.dataset.key]=ae(o.dataset.side),r=!0});let a={key:e.dataset.key};return e.dataset.comment!=""&&(a.comment=e.dataset.comment),r&&(a.params=n),e.dataset.key=="psi:constant_number"&&(a.constantValue=e.querySelector("[data-value]").textContent),a}function oe(e){if(e instanceof Uint8Array){let n=0,r=e[n++],a=new TextDecoder().decode(e.slice(n,n+r)),o=q(A[a]);n+=r;let s=e[n++]|e[n++]<<8;o.dataset.comment=new TextDecoder().decode(e.slice(n,n+s)),n+=s;let i=e[n++];for(let l=0;l<i;l++){let p=e[n++],v;p==255?v="_"+z[e[n++]]:(v=new TextDecoder().decode(e.slice(n,n+p)),n+=p);let _=e[n++];k(o.querySelector(`.param[data-key="${v}"]`),se(_))}if(a=="psi:constant_number"){let l=e[n++],p=new TextDecoder().decode(e.slice(n,n+l));n+=l;let v=o.querySelector("[data-value]");v.textContent=p,v.style.setProperty("--scale-value",[1,1,.8,.7,.6,.5][p.length-1])}return o}let t=q(A[e.key]);if(e.params)for(const[n,r]of Object.entries(e.params))k(t.querySelector(`.param[data-key="${n}"]`),se(r));if(e.comment&&(t.dataset.comment=e.comment),e.constantValue){let n=t.querySelector("[data-value]");n.textContent=e.constantValue,n.style.setProperty("--scale-value",[1,1,.8,.7,.6,.5][e.constantValue.length-1])}return t}function ae(e){return{off:0,top:1,bottom:2,left:3,right:4}[e||"off"]}function se(e){return["off","top","bottom","left","right"][e]}function Le(e){return{left:"right",right:"left",top:"bottom",bottom:"top",off:"off"}[e]}function $e(e,t,n=null){if(!t.cell||!t.cell.piece)return!1;let r=t.cell.piece;if(r.dataset.key=="psi:constant_number"){if("FDfd".includes(e))return!1;let a=r.querySelector("[data-value]"),o=a.textContent;if(e=="Backspace")o.startsWith(".")?o="0"+o:o.startsWith("-.")&&(o="-0"+o.substring(1)),o=="-0"?o="0":o.startsWith("-")&&o.length==2?o="-0":o=o.substring(0,o.length-1).trim();else if((o=="0"||o=="-0")&&e!="-"&&e!="+"&&(o=o.replace("0","")),e=="+"?o.startsWith("-")&&(o=o.substring(1)):e=="-"?o.startsWith("-")||(o="-"+o):o=(o+e).trim(),o.length>5?o.startsWith("0.")?o=o.substring(1):o.startsWith("-0.")&&(o="-"+o.substring(2)):o.startsWith(".")?o="0"+o:o.startsWith("-.")&&(o="-0"+o.substring(1)),o.length>5)return!1;return o==""&&(o="0"),isNaN(parseFloat(o))?!1:(a.textContent=o,a.style.setProperty("--scale-value",[1,1,.8,.7,.6,.5][o.length-1]),n&&w(n,t),!0)}return!1}let ie="PsiEdit",le=[];function Pe(e,t,n,r=null,a=null){let o=[];for(let s=0;s<t;s++){o[s]=[];for(let i=0;i<n;i++)o[s][i]=Ue(e,o,s,i,r,a)}return o.width=t,o.height=n,o}function Ue(e,t,n,r,a=null,o=null){let s={element:e.div("cell"),piece:null};return a&&(s.element.addEventListener("mousedown",i=>{i.button==0?M(t,o,n,r,a):i.button==2&&(j(s),w(a,o))}),["top","bottom"].forEach(i=>["left","right"].forEach(l=>s.element.div("selection",i,l)))),s}function M(e,t,n,r,a=null){t.x==n&&t.y==r||(t.cell&&t.cell.element.classList.remove("selected"),t.x=n,t.y=r,t.cell=e[n][r],t.cell.element.classList.add("selected"),a&&w(a,t))}function ce(e,t=!1){let n=[],r=new Uint8Array(Math.ceil(e.width*e.height/8)),a=0,o=0;for(let s=0;s<e.width;s++)for(let i=0;i<e.height;i++){if(a=a<<1&255,e[s][i].piece){a|=1;let l=qe(e[s][i].piece,t);if(t){if(l.length>65535)throw new Error("Piece data too large");n.push(new Uint8Array([l.length>>0&255,l.length>>8&255])),n.push(l)}else n.push({x:s,y:i,data:l})}++o%8==0&&r.set([a],o/8-1)}if(o%8!=0&&r.set([a],o/8),t){let s=new Uint8Array(r.length+n.map(l=>l.length).reduce((l,p)=>l+p));s.set(r,0);let i=r.length;for(let l of n)s.set(l,i),i+=l.length;return s}else return{modsRequired:le,validSpell:!0,spellName:ie,spellList:n}}function L(e,t){for(let n=0;n<t.width;n++)for(let r=0;r<t.height;r++)j(t[n][r]);if(e instanceof Uint8Array){let n=e.subarray(0,Math.ceil(t.width*t.height/8)),r=0,a=n.length;for(let o=0;o<t.width;o++)for(let s=0;s<t.height;s++){if(n[Math.floor(r/8)]>>7-r%8&1){let i=e[a+0]<<0|e[a+1]<<8,l=oe(e.subarray(a+2,a+i+2));E(t[o][s],l),a+=i+2}r++}}else{le=e.modsRequired,ie=e.spellName;for(let n of e.spellList)E(t[n.x][n.y],oe(n.data))}}function ue(e){let[t,n]=Ne(!0),[r,a]=de(e),o=t.get(r),s=o,i=s[0];for(;a<e.length;){let l;[l,a]=de(e,a);let p;if(t.has(l))p=t.get(l);else{if(a==0||l!=n)throw"Invalid input";p=s+i}o+=p,i=p[0],a>0&&t.set(n++,s+i),s=p}return o}function Ne(e){let t=new Map,n=new Map,r=128,a=0;function o(s,i=!1){s==""||t.has(s)||(i&&a>=128&&(a++,i=!1),t.set(s,i?a:r),n.set(i?a:r,s),i?a++:r++,o(s.substring(0,s.length-1)))}for(let s=0;s<256;s++)o(String.fromCharCode(s),String.fromCharCode(s).match(/[a-z0-9.:_;<=>]/)||s<64);return["psi:","phi:","trick_","operator_","selector_","constant","nearby_","list","mass_","motion","block","caster","number","vector","entity","sum","subtract","multiply","divide","absolute","inverse","modulus","sin","cos","asin","acos","min","max","sign","square","root","power","log","operator_vector_extract_x","operator_vector_extract_y","operator_vector_extract_z","operator_vector_construct"].forEach(s=>o(s,!0)),[e?n:t,r]}function de(e,t=0){let n=0,r=0;for(;e.charCodeAt(r+t)&128;)n|=(e.charCodeAt(r+t)&127)<<r*7,r++;return n|=e.charCodeAt(r+t)<<r*7,[n,r+1+t]}let u;const h=new Array(128).fill(void 0);h.push(void 0,null,!0,!1);function c(e){return h[e]}let $=h.length;function Ce(e){e<132||(h[e]=$,$=e)}function y(e){const t=c(e);return Ce(e),t}const fe=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});fe.decode();let P=null;function I(){return(P===null||P.byteLength===0)&&(P=new Uint8Array(u.memory.buffer)),P}function U(e,t){return fe.decode(I().subarray(e,e+t))}function d(e){$===h.length&&h.push(h.length+1);const t=$;return $=h[t],h[t]=e,t}let S=0;const D=new TextEncoder("utf-8"),Te=typeof D.encodeInto=="function"?function(e,t){return D.encodeInto(e,t)}:function(e,t){const n=D.encode(e);return t.set(n),{read:e.length,written:n.length}};function N(e,t,n){if(n===void 0){const i=D.encode(e),l=t(i.length);return I().subarray(l,l+i.length).set(i),S=i.length,l}let r=e.length,a=t(r);const o=I();let s=0;for(;s<r;s++){const i=e.charCodeAt(s);if(i>127)break;o[a+s]=i}if(s!==r){s!==0&&(e=e.slice(s)),a=n(a,r,r=s+e.length*3);const i=I().subarray(a+s,a+r),l=Te(e,i);s+=l.written}return S=s,a}function G(e){return e==null}let C=null;function f(){return(C===null||C.byteLength===0)&&(C=new Int32Array(u.memory.buffer)),C}let T=null;function Oe(){return(T===null||T.byteLength===0)&&(T=new Float64Array(u.memory.buffer)),T}function K(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const a=e.description;return a==null?"Symbol":`Symbol(${a})`}if(t=="function"){const a=e.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(e)){const a=e.length;let o="[";a>0&&(o+=K(e[0]));for(let s=1;s<a;s++)o+=", "+K(e[s]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(n.length>1)r=n[1];else return toString.call(e);if(r=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:r}function X(e,t){try{return e.apply(this,t)}catch(n){u.__wbindgen_export_2(d(n))}}function _e(e){try{const a=u.__wbindgen_add_to_stack_pointer(-16),o=N(e,u.__wbindgen_export_0,u.__wbindgen_export_1),s=S;u.snbtToSpell(a,o,s);var t=f()[a/4+0],n=f()[a/4+1],r=f()[a/4+2];if(r)throw y(n);return y(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function ge(e){try{const a=u.__wbindgen_add_to_stack_pointer(-16),o=N(e,u.__wbindgen_export_0,u.__wbindgen_export_1),s=S;u.urlSafeToSpell(a,o,s);var t=f()[a/4+0],n=f()[a/4+1],r=f()[a/4+2];if(r)throw y(n);return y(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function je(e){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.spellToUrlSafe(i,d(e));var t=f()[i/4+0],n=f()[i/4+1],r=f()[i/4+2],a=f()[i/4+3],o=t,s=n;if(a)throw o=0,s=0,y(r);return U(o,s)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_export_3(o,s)}}function Re(e){try{const i=u.__wbindgen_add_to_stack_pointer(-16);u.spellToSnbt(i,d(e));var t=f()[i/4+0],n=f()[i/4+1],r=f()[i/4+2],a=f()[i/4+3],o=t,s=n;if(a)throw o=0,s=0,y(r);return U(o,s)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_export_3(o,s)}}async function We(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function Me(){const e={};return e.wbg={},e.wbg.__wbg_get_27fe3dac1c4d0224=function(t,n){const r=c(t)[n>>>0];return d(r)},e.wbg.__wbg_length_e498fbc24f9c1d4f=function(t){return c(t).length},e.wbg.__wbg_next_88560ec06a094dea=function(){return X(function(t){const n=c(t).next();return d(n)},arguments)},e.wbg.__wbg_done_1ebec03bbd919843=function(t){return c(t).done},e.wbg.__wbg_value_6ac8da5cc5b3efda=function(t){const n=c(t).value;return d(n)},e.wbg.__wbindgen_object_drop_ref=function(t){y(t)},e.wbg.__wbg_iterator_55f114446221aa5a=function(){return d(Symbol.iterator)},e.wbg.__wbg_get_baf4855f9a986186=function(){return X(function(t,n){const r=Reflect.get(c(t),c(n));return d(r)},arguments)},e.wbg.__wbindgen_is_function=function(t){return typeof c(t)=="function"},e.wbg.__wbg_call_95d1ea488d03e4e8=function(){return X(function(t,n){const r=c(t).call(c(n));return d(r)},arguments)},e.wbg.__wbindgen_is_object=function(t){const n=c(t);return typeof n=="object"&&n!==null},e.wbg.__wbg_next_b7d530c04fd8b217=function(t){const n=c(t).next;return d(n)},e.wbg.__wbindgen_string_new=function(t,n){const r=U(t,n);return d(r)},e.wbg.__wbg_new_b525de17f44a8943=function(){const t=new Array;return d(t)},e.wbg.__wbg_set_17224bc548dd1d7b=function(t,n,r){c(t)[n>>>0]=y(r)},e.wbg.__wbg_isArray_39d28997bf6b96b4=function(t){return Array.isArray(c(t))},e.wbg.__wbg_instanceof_ArrayBuffer_a69f02ee4c4f5065=function(t){let n;try{n=c(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_isSafeInteger_8c4789029e885159=function(t){return Number.isSafeInteger(c(t))},e.wbg.__wbg_entries_4e1315b774245952=function(t){const n=Object.entries(c(t));return d(n)},e.wbg.__wbg_new_f9876326328f45ed=function(){const t=new Object;return d(t)},e.wbg.__wbg_length_27a2afe8ab42b09f=function(t){return c(t).length},e.wbg.__wbindgen_memory=function(){const t=u.memory;return d(t)},e.wbg.__wbg_buffer_cf65c07de34b9a08=function(t){const n=c(t).buffer;return d(n)},e.wbg.__wbg_new_537b7341ce90bb31=function(t){const n=new Uint8Array(c(t));return d(n)},e.wbg.__wbg_set_17499e8aa4003ebd=function(t,n,r){c(t).set(c(n),r>>>0)},e.wbg.__wbg_instanceof_Uint8Array_01cebe79ca606cca=function(t){let n;try{n=c(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbindgen_error_new=function(t,n){const r=new Error(U(t,n));return d(r)},e.wbg.__wbg_String_88810dfeb4021902=function(t,n){const r=String(c(n)),a=N(r,u.__wbindgen_export_0,u.__wbindgen_export_1),o=S;f()[t/4+1]=o,f()[t/4+0]=a},e.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(t,n){const r=c(t)[c(n)];return d(r)},e.wbg.__wbindgen_is_undefined=function(t){return c(t)===void 0},e.wbg.__wbindgen_in=function(t,n){return c(t)in c(n)},e.wbg.__wbindgen_string_get=function(t,n){const r=c(n),a=typeof r=="string"?r:void 0;var o=G(a)?0:N(a,u.__wbindgen_export_0,u.__wbindgen_export_1),s=S;f()[t/4+1]=s,f()[t/4+0]=o},e.wbg.__wbindgen_number_get=function(t,n){const r=c(n),a=typeof r=="number"?r:void 0;Oe()[t/8+1]=G(a)?0:a,f()[t/4+0]=!G(a)},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return c(t)==c(n)},e.wbg.__wbg_set_841ac57cff3d672b=function(t,n,r){c(t)[y(n)]=y(r)},e.wbg.__wbindgen_number_new=function(t){return d(t)},e.wbg.__wbindgen_is_string=function(t){return typeof c(t)=="string"},e.wbg.__wbindgen_boolean_get=function(t){const n=c(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_object_clone_ref=function(t){const n=c(t);return d(n)},e.wbg.__wbindgen_debug_string=function(t,n){const r=K(c(n)),a=N(r,u.__wbindgen_export_0,u.__wbindgen_export_1),o=S;f()[t/4+1]=o,f()[t/4+0]=a},e.wbg.__wbindgen_throw=function(t,n){throw new Error(U(t,n))},e}function Ie(e,t){return u=e.exports,pe.__wbindgen_wasm_module=t,T=null,C=null,P=null,u}async function pe(e){typeof e>"u"&&(e=new URL("/PsiEdit/assets/psi_spell_encode_wasm_bg-700d8052.wasm",self.location));const t=Me();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:r}=await We(await e,t);return Ie(n,r)}function De(){let e=new URLSearchParams(location.search);if(e.has("cursor")){let[t,n]=e.get("cursor").split(/-?/).map(r=>parseInt(r)-1);M(b,g,O(t,B),O(n,F))}if(e.has("spell")){let t=e.get("spell").match(/^([LG])?(?:([0-9]+)-)?(.*)$/),n=t[1],r=t[2],a=t[3];if(r==1)switch(n){case"L":a=t[3].replaceAll("_","/").replaceAll(".","+"),a.length%4==1?a+="=":a.length%4==2&&(a+="=="),L(new Uint8Array([...ue(atob(a))].map(o=>o.charCodeAt())),b);break;case"G":L(ge(a),b);break}else r==2?L(ge(t[3]),b):(n=="L"&&(a=ue(atob(a))),L(_e(decodeURIComponent(atob(a))),b));w(m,g)}}function me(){if(b.some(e=>e.some(t=>t.piece))){let e=new URLSearchParams;e.set("cursor",`${g.x+1}-${g.y+1}`),e.set("spell","G1-"+je(ce(b,!1))),history.replaceState({},"",`${location.pathname}?${e}`)}else history.replaceState({},"",location.pathname)}const Be="/PsiEdit/assets/psi_spell_encode_wasm_bg-700d8052.wasm",Fe="/PsiEdit/assets/psi-8969a07a.html",Ve="/PsiEdit/assets/phi-c032e098.html";await pe(Be);const be=9,B=be,F=be,ze=document.querySelector("#spell-grid"),V=document.querySelector("#search"),Ge=document.querySelector("#export"),Ke=document.querySelector("#import"),Xe=document.querySelector("#delete");let g={},m={element:document.querySelector("#piece-config"),controls:[],params:[],comment:null},b=Pe(ze,B,F,m,g);M(b,g,4,4);const H=document.querySelector("#piece-catalog");let A={};await Promise.allSettled([Fe,Ve].map(He)),De();async function He(e){let t=await Q(e),n=await Ee(t);Object.assign(A,n),Je()}function Je(){H.innerHTML="",Object.values(A).sort((e,t)=>Z(e)>Z(t)).forEach(e=>{let t=H.div("catalog-item");t.append(e.cloneNode(!0)),t.addEventListener("click",()=>{E(g.cell,q(e)),w(m,g)})})}function Qe(){let e=V.value.toLowerCase();H.childNodes.forEach(t=>{let n=t.querySelector(".piece");t.hidden=!n.dataset.name.toLowerCase().includes(e)})}function ye(){prompt("Export Spell SNBT",Re(ce(b))),me()}function we(){L(_e(prompt("Import Spell SNBT")),b),me(),w(m,g)}function he(){j(g.cell),w(m,g)}V.addEventListener("input",Qe),Ge.addEventListener("click",ye),Ke.addEventListener("click",we),Xe.addEventListener("click",he);let J;document.addEventListener("keydown",e=>{if(e.getModifierState("Control")&&e.key=="d"&&(e.preventDefault(),m.comment&&(e.target==m.comment?document.activeElement.blur():m.comment.focus())),["INPUT","TEXTAREA"].includes(e.target.nodeName)){e.key=={INPUT:"Enter",TEXTAREA:"Escape"}[e.target.nodeName]&&(e.preventDefault(),document.activeElement.blur());return}if(e.key=="Enter"){V.focus(),V.select();return}if($e(e.key,g,m))return;["Delete","Backspace"].includes(e.key)&&he(),"123456789".includes(e.key)&&(J=e.key);let t=m.params[J-1];if(t){e.key=="ArrowLeft"&&k(t,R(t)=="left"&&W(t)?"off":"left",g,m),e.key=="ArrowRight"&&k(t,R(t)=="right"&&W(t)?"off":"right",g,m),e.key=="ArrowUp"&&k(t,R(t)=="top"&&W(t)?"off":"top",g,m),e.key=="ArrowDown"&&k(t,R(t)=="bottom"&&W(t)?"off":"bottom",g,m);return}let n=g.x,r=g.y,a="off";if(e.key=="ArrowLeft"&&(n--,a="left"),e.key=="ArrowRight"&&(n++,a="right"),e.key=="ArrowUp"&&(r--,a="top"),e.key=="ArrowDown"&&(r++,a="bottom"),e.shiftKey&&Y(n,B)&&Y(r,F)&&a!="off"&&!b[n][r].piece){let o=q(A["psi:connector"]);k(o.querySelector(".param[data-key=_target]"),Le(a)),E(b[n][r],o)}M(b,g,O(n,B),O(r,F),m),e.key=="e"&&ye(),e.key=="i"&&we()}),document.addEventListener("keyup",e=>{"123456789".includes(e.key)&&(J=null)}),document.addEventListener("contextmenu",e=>e.preventDefault())})();
